{
  "active": false,
  "connections": {
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Cancelar": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Agendar": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "disponibilidad": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-07-10T20:55:46.012Z",
  "id": "qt0CQTb7mVPd9TNS",
  "isArchived": false,
  "meta": null,
  "name": "UDIA-AGENTE DE IA CITAS",
  "nodes": [
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.1,
      "position": [
        -100,
        -20
      ],
      "id": "7b5a1661-d1bd-4ea0-8fe1-f0abb10782a3",
      "name": "When chat message received",
      "webhookId": "fd1eed67-4478-43e2-9e57-a8fe3dd925d6"
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "=# ROL \n\nEres miguel el asistente virtual de la clinica estetica bora bora, llevas mas de 10 años ayudando en la atencion al publico de la clinica eres util e inteligente \n\n# CONTEXTO\n\nVas a responder todos los mensajes de los clientes entrantes y vas a intentar agendar a todos los leads que busquen un turno en la clinica \n\nNuestros servicios son, rinoplastia y botox ambos tienen un precio de 1000 USD y cada uno solo 500 USD \n\n\n# TAREA\n\nTu tarea consiste en entender la conversacion, los mensajes del usuario y activar las funciones necesarias para tener una conversacion fluida y natural y que el cliente se quede satisfecho\n\n# Proceso de agendacion \n\n1. Cuando el cliente te diga que quiere agendar un cita o le interesa agendar una cita, debes preguntarle por el dia que quiere la cita\n2. Debes activar la herramienta disponibilidad enviando a la herramienta la fecha en este formato yyyy-mm-dd\n3. Enviale al usuario todos los horarios disponibles en ese dia que dijo que queria la cita\n4. Cuando el cliente diga la hora que quiere, debes pedirle que te diga su email y nombre completo\n5. Activa la herramienta citas enviando la fecha en este formato yyyy-mm-dd y la hora en este formato 00:00:00\n6. Enviarle un mensaje al usuario que se ha registrado la cita y que lo esperamos \n\n## Herramienta cancelar : \n\nDebes activar esta herramienta para cuando el usuario desea re agendar una cita o cancelar. \n\nEn caso de que quiera cancelar debes activar la herramienta y preguntarle si desea elegir un horario nuevo, de ser asi debes activar de cero el procedimiento de agendacion \n\n\n# NOTAS GENERALES\n\n- La fecha de hoy es : {{ $now }} y estamos en el año 2025 siempre. \n\n- Si te dicen mañana, el proximo lunes o se refieren de sa forma a una fecha en especifico. utiliza : {{ $now }} para saber cual es el dia de hoy y calcula cual es la fecha mas proxima a la que se refiere el usuario, es decir que si te dcien el proximo lunes, debes interpretar que es lunes mas cerca de la fecha de ahora\n\n- Este es un calendario anual de todos los primero dias de el año \n\nCalendario 2025: Primer Día de Cada Mes\nEnero: Miércoles\nFebrero: Sábado\nMarzo: Sábado\nAbril: Martes\nMayo: Jueves\nJunio: Domingo\nJulio: Martes\nAgosto: Viernes\nSeptiembre: Lunes\nOctubre: Miércoles\nNoviembre: Sábado\nDiciembre: Lunes\n\n# ESTRUCTURA DE SALIDA\n\nEnvia mensajes calidos, respetuosos y formales\n\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        120,
        -20
      ],
      "id": "98fcc6b0-b11f-41bf-921c-295b4248ba84",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -140,
        240
      ],
      "id": "7f49203c-d1b2-4f60-855c-8046fbb7c8f4",
      "name": "OpenAI Chat Model"
    },
    {
      "parameters": {
        "tableName": "Pruebaudia"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        40,
        240
      ],
      "id": "ec84cdd8-0aa5-4b87-8cb3-cb2df96f4c60",
      "name": "Postgres Chat Memory"
    },
    {
      "parameters": {
        "description": "Esta herramienta sirve para cancelar la agenda del usuario",
        "workflowId": {
          "__rl": true,
          "value": "oFzCtaKdA55Z2cjJ",
          "mode": "list",
          "cachedResultName": "Cancelar"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        160,
        320
      ],
      "id": "1b9ed0b5-e309-44e8-843b-96018bdd0382",
      "name": "Cancelar"
    },
    {
      "parameters": {
        "description": "Esta herramienta se encarga de agendar al usuario en el calendario",
        "workflowId": {
          "__rl": true,
          "value": "EJsR7TbmyY6yChwD",
          "mode": "list",
          "cachedResultName": "Agendar"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "fecha": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fecha', `la fecha que eligio el usuario para agendar en formato yyyy-mm-dd`, 'string') }}",
            "horario": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('horario', `El horario que eligio el usuario en formato 00:00:00`, 'string') }}",
            "nombre completo": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('nombre_completo', `Nombre completo del usuario`, 'string') }}",
            "email": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('email', `Email del usuario`, 'string') }}"
          },
          "matchingColumns": [
            "fecha"
          ],
          "schema": [
            {
              "id": "fecha",
              "displayName": "fecha",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "horario",
              "displayName": "horario",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "nombre completo",
              "displayName": "nombre completo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        480,
        320
      ],
      "id": "4d849494-c81b-47f4-8435-7dd1bd60a7cd",
      "name": "Agendar"
    },
    {
      "parameters": {
        "description": "Esta herramienta sirve para ver al disponibilidad en el calendario",
        "workflowId": {
          "__rl": true,
          "value": "TXQFEpcOPKlzS877",
          "mode": "list",
          "cachedResultName": "Disponibilidad"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "fecha": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fecha', `la fecha que eligio el usuario para agendar en formato yyyy-mm-dd`, 'string') }}"
          },
          "matchingColumns": [
            "fecha"
          ],
          "schema": [
            {
              "id": "fecha",
              "displayName": "fecha",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        320,
        300
      ],
      "id": "fd63d0bb-bd3f-4392-ac1c-b1b7ef52a17b",
      "name": "disponibilidad"
    }
  ],
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-07-10T20:58:03.000Z",
  "versionId": "ed37d802-9f66-4ee6-8ba6-463ba1be8a09"
}